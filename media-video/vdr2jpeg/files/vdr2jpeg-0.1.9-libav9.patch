--- ffm.cpp.old	2013-06-22 20:12:27.972712290 +0200
+++ ffm.cpp	2013-06-22 20:13:33.586709956 +0200
@@ -672,7 +672,7 @@
                         ost->file_index, ost->index);
                 return false;
             }
-            if (avcodec_open(ost->st->codec, codec) < 0) {
+            if (avcodec_open2(ost->st->codec, codec, NULL) < 0) {
                 fprintf(stderr, "Error while opening codec for output stream #%d.%d - maybe incorrect parameters such as bit_rate, rate, width or height\n",
                         ost->file_index, ost->index);
                 return false;
@@ -691,7 +691,7 @@
                         ist->st->codec->codec_id, ist->file_index, ist->index);
                 return false;
             }
-            if (avcodec_open(ist->st->codec, codec) < 0) {
+            if (avcodec_open2(ist->st->codec, codec, NULL) < 0) {
                 fprintf(stderr, "Error while opening codec for input stream #%d.%d\n",
                         ist->file_index, ist->index);
                 return false;
@@ -937,7 +937,7 @@
 
     /* If not enough info to get the stream parameters, we decode the
        first frames to get it. (used in mpeg case for example) */
-    ret = av_find_stream_info(ic);
+    ret = avformat_find_stream_info(ic, NULL);
     if (ret < 0 && verbose >= 0) {
         fprintf(stderr, "%s: co--- ffm.cpp.old	2013-06-22 20:12:27.972712290 +0200
+++ ffm.cpp	2013-06-22 20:13:33.586709956 +0200
@@ -672,7 +672,7 @@
                         ost->file_index, ost->index);
                 return false;
             }
-            if (avcodec_open(ost->st->codec, codec) < 0) {
+            if (avcodec_open2(ost->st->codec, codec, NULL) < 0) {
                 fprintf(stderr, "Error while opening codec for output stream #%d.%d - maybe incorrect parameters such as bit_rate, rate, width or height\n",
                         ost->file_index, ost->index);
                 return false;
@@ -691,7 +691,7 @@
                         ist->st->codec->codec_id, ist->file_index, ist->index);
                 return fal